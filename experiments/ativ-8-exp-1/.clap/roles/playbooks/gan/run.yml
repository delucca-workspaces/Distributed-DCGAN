---
- name: Run GAN
  hosts: all
  gather_facts: yes
  tasks:
  - name: Copy SSH key
    copy:
      src: "{{ lookup('env', 'HOME') }}/.clap/private/aws-login.pem"
      dest: "{{ ansible_env.HOME }}/.ssh/id_rsa"
      mode: 0600

  - name: Launches DCGAN trainning
    become: no
    command: mpirun -v -np {{ worker_node_ips.split(',') | length }} --host "{{ worker_node_ips }}" launch-node "-m={{ master_node_ip }} -n={{ worker_node_ips.split(',') | length }}"
    args:
      chdir: "{{ ansible_env.HOME }}/.local/src/Distributed-DCGAN/experiments/ativ-8-exp-1/bin"
