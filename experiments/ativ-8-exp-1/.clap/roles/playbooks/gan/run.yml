---
- name: Run GAN
  hosts: all
  gather_facts: yes
  tasks:
  - name: Copy SSH key
    copy:
      src: "{{ lookup('env', 'HOME') }}/.clap/private/aws-login.pem"
      dest: "{{ ansible_env.HOME }}/.ssh/id_rsa"
      mode: 0600

  - name: Launches DCGAN trainning
    become: no
    command: mpirun -v -np {{ ansible_all_ipv4_addresses | length }} --host {{ ansible_default_ipv4.address }} launch-node "-m={{ ansible_default_ipv4.address }} -n={{ ansible_all_ipv4_addresses | join(',') }}"
    args:
      chdir: "{{ ansible_env.HOME }}/.local/src/Distributed-DCGAN/experiments/ativ-8-exp-1/bin"
