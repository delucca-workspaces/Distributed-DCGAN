---
- name: Setup GAN
  hosts: all
  gather_facts: yes
  tasks:
  - name: Update packages
    become: yes
    apt:
      upgrade: yes
      update_cache: yes

  - name: Ensure dependencies
    become: yes
    package:
      name:
      - make
      - gcc
      - libgfortran5
      - sysstat
      - libibnetdisc-dev
      - openmpi-bin
      - libopenmpi-dev
      - libhdf5-openmpi-dev
      - gfortran
      - build-essential
      - git
      state: present

  - name: Ensure local folder structure
    become: no
    file:
      path: "{{ ansible_env.HOME }}/.local/src"
      state: directory

  - name: Clone remote repository
    become: no
    git:
      repo: https://github.com/delucca-workspaces/Distributed-DCGAN.git
      dest: "{{ ansible_env.HOME }}/.local/src/Distributed-DCGAN"
      version: ativ-8-exp-1

  - name: Ensure CIFAR10 temporary folder structure
    become: no
    file:
      path: "{{ ansible_env.HOME }}/.local/src/Distributed-DCGAN/cifar10"
      state: directory

  - name: Download CIFAR10 dataset
    become: no
    get_url:
      url: https://www.cs.toronto.edu/~kriz/cifar-10-python.tar.gz
      dest: /tmp/cifar10.tar.gz

  - name: Extract CIFAR10 dataset
    become: no
    unarchive:
      src: /tmp/cifar10.tar.gz
      dest: "{{ ansible_env.HOME }}/.local/src/Distributed-DCGAN/cifar10"
      remote_src: yes
